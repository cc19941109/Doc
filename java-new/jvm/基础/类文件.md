# 类文件

## 参考


## 入门

### jvm

java 虚拟机运行的是 ```.class``` 的字节码文件

#### 为什么 jvm 上可以运行其他语言

jvm 并不关心 ```.class```的字节码文件来源是哪种语言.

比如: 

1. java  ->  javac 编译器 -> class 文件
2. groovy -> groovyc 编译器 -> class 文件
3. JRuby  -> jrubyc 编译器 -> class 文件

1. java 语言中的各种变量,关键字,运算符的语义都是由多条字节码命令组合而成的
2. 字节码命令所能提供的语义描述能力比 java 语言本身更加强大, 这为一些有别于 java 的语言特性提供了基础

## 类文件结构

Class 文件是一组以8位字节为基础单位的二进制流,没有任何分隔符

当遇到需要占用8位字节以上空间时的数据项时,则按照高位在前的方式分割成若干个8位自己进行存储

### 伪结构

Class 文件采用类似于 C 语言结构体的伪结构来存储数据.这种伪结构只有两种数据类型

1. 无符号数
2. 表

整个 Class 文件本质上是一张表.

### Hello.class

```
public class Hello{
    public static void main(String[] args){
        System.out.println("hello world");
    }
}
```

通过 ```javac Hello.class```编译后,得到如下:

```
cafe babe 0000 0034 001d 0a00 0600 0f09
0010 0011 0800 120a 0013 0014 0700 1507
0016 0100 063c 696e 6974 3e01 0003 2829
5601 0004 436f 6465 0100 0f4c 696e 654e
756d 6265 7254 6162 6c65 0100 046d 6169
6e01 0016 285b 4c6a 6176 612f 6c61 6e67
2f53 7472 696e 673b 2956 0100 0a53 6f75
7263 6546 696c 6501 000a 4865 6c6c 6f2e
6a61 7661 0c00 0700 0807 0017 0c00 1800
1901 000b 6865 6c6c 6f20 776f 726c 6407
001a 0c00 1b00 1c01 0005 4865 6c6c 6f01
0010 6a61 7661 2f6c 616e 672f 4f62 6a65
6374 0100 106a 6176 612f 6c61 6e67 2f53
7973 7465 6d01 0003 6f75 7401 0015 4c6a
6176 612f 696f 2f50 7269 6e74 5374 7265
616d 3b01 0013 6a61 7661 2f69 6f2f 5072
696e 7453 7472 6561 6d01 0007 7072 696e
746c 6e01 0015 284c 6a61 7661 2f6c 616e
672f 5374 7269 6e67 3b29 5600 2100 0500
0600 0000 0000 0200 0100 0700 0800 0100
0900 0000 1d00 0100 0100 0000 052a b700
01b1 0000 0001 000a 0000 0006 0001 0000
0001 0009 000b 000c 0001 0009 0000 0025
0002 0001 0000 0009 b200 0212 03b6 0004
b100 0000 0100 0a00 0000 0a00 0200 0000
0300 0800 0400 0100 0d00 0000 0200 0e
```

### 解析

```
 cafe babe    0000 	  0034   	 001d        0a         0006 000f  09
magic_Number 次版本号 主版本号52 常量池count  方法符号引用  

0010 0011 0800 120a 0013 0014 0700 1507

0016 0100 063c 696e 6974 3e01 0003 2829

5601 0004 436f 6465 0100 0f4c 696e 654e

756d 6265 7254 6162 6c65 0100 046d 6169

6e01 0016 285b 4c6a 6176 612f 6c61 6e67

2f53 7472 696e 673b 2956 0100 0a53 6f75

7263 6546 696c 6501 000a 4865 6c6c 6f2e

6a61 7661 0c00 0700 0807 0017 0c00 1800

1901 000b 6865 6c6c 6f20 776f 726c 6407

001a 0c00 1b00 1c01 0005 4865 6c6c 6f01

0010 6a61 7661 2f6c 616e 672f 4f62 6a65

6374 0100 106a 6176 612f 6c61 6e67 2f53
7973 7465 6d01 0003 6f75 7401 0015 4c6a
6176 612f 696f 2f50 7269 6e74 5374 7265
616d 3b01 0013 6a61 7661 2f69 6f2f 5072
696e 7453 7472 6561 6d01 0007 7072 696e
746c 6e01 0015 284c 6a61 7661 2f6c 616e
672f 5374 7269 6e67 3b29 5600 2100 0500
0600 0000 0000 0200 0100 0700 0800 0100
0900 0000 1d00 0100 0100 0000 052a b700
01b1 0000 0001 000a 0000 0006 0001 0000
0001 0009 000b 000c 0001 0009 0000 0025
0002 0001 0000 0009 b200 0212 03b6 0004
b100 0000 0100 0a00 0000 0a00 0200 0000
0300 0800 0400 0100 0d00 0000 0200 0e
```

### 常量池

1. 字面量
	
	- 文本字符串
	- final 常量值

2. 符号引用
	
	- 类和接口的全限定名
	- 字段的名称和描述符
	- 方法的名称和描述符

常量池中的每一项常量都是一个表

### javap

```javap -v Hello```
	
用于分析 Class 文件字节码






